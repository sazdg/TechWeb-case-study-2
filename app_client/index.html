<!DOCTYPE html>
<html>
    <head>
        <title>PHP case study 2</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content="case study #2" />
        <meta name="author" content="saz" />
        <link rel="stylesheet" href="./stile/stile.css">
        <!--JQuery CDN-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <script>

            $(document).ready(function(){

                $("#leggi").on("click", function(){
                    $.ajax({
                        url:"../api_server/api/read.php",
                        type:"POST",
                        dataType:'json'
                    })
                    .done(function(response){
                        var lista = "<ul>";
                            for(let i = 0; i < response.products.length; i++){
                                var id = response.products[i].id;
                                var nome = response.products[i].name;
                                var prezzo = response.products[i].price;
                                lista += "<li>" + id + " " + nome + " " + prezzo + "</li>";
                            }
                        lista += "</ul>";
                        $("#AllProducts").html(lista);
                    })
                    .fail(function(xhr, resp, text){
                        console.log(xhr, resp, text);
                        $("#AllProducts").html(xhr+resp+text);
                    });
                    return false;//necessario per far funzionare on click
                });

                $("#delete").on("click", function(){

                    var id_elimina = $("#eliminare").val();
                    $.ajax({
                        url: "http://localhost/cime/case-study-2/api_server/api/delete.php?eliminare="
                        +id_elimina,
                        //sembra una finta get, c'è l'url ma non c'è il method e non c'è il form
                        type: "DELETE",
                        dataType: 'json',
                        
                    })
                    .done(function(response){
                        html_par = "<p>"+response.message+"</p>";

                        $("#response_delete").html(html_par);
                    })
                    .fail(function(xhr, resp, text){
                        console.log(xhr, resp, text);
                    })
                    return false;
                });
                
            });
        </script>
    </head>

    <body>
        <p id="title">TECH WEB - CASE STUDY #2</p>
        <br/>
        <div id="consegna">
            Descrizione negozio di fumetti tipo: <br/>
            <strong>backend:</strong> i dati del database, 
            i servizi sono nella cartella api (-create, delete, -read, read.one, -update, search)
            <br/>
            <strong>frontend:</strong> index html
        </div>

        <div id="_read">
            <!--AJAX-->
            <span><strong>Elenco di tutti i prodotti:</strong></span><br/>
            <span id="AllProducts"></span>
            <a href="#" id="leggi"> Clicca per vedere</a><br/>
        </div>

        <div id="_read_one"></div>

        <div id="_test">
            <span><strong>Database test:</strong></span>

            <form action="../api_server/api/test.php" method="get">
                <input type="submit" value="Test">
            </form>
        </div>

        <div id="_search"></div>

        <div id="_create">
            <span><strong>Crea un nuovo prodotto:</strong></span>
            <br />

            <form action="../api_server/api/create.php" method="get">
                <span>Nome:</span><br/>
                <input type="text" name="new_item"><br/>
                <span>Descrizione:</span><br/>
                <input type="text" name="descrizione"><br />
                <span>Prezzo:</span><br/>
                <input type="text" name="prezzo"><br />
                <span>Categoria id: 1(tex) 2(dylan dog) 3(topolino):</span><br/>
                <input type="text" name="cat_id"><br />
                <input type="submit" value="Aggiugi">
            </form>
        </div>

        <div id="_delete">
            <!--AJAX-->
            <span><strong>Elimina un prodotto:</strong></span><br/>
            
            <div>
                <span>ID (numeri):</span><br/>
                <input type="text" name="eliminare" id="eliminare"><br/>
                <button type="button" id="delete">Elimina</button>
            </div>

            <div id="response_delete"></div>
        </div>

        <div id="_update">
            <span><strong>Aggiorna le informazioni di un prodotto:</strong></span>
            <form action="../api_server/api/update.php" method="get">
                <span>Scegli l'ID del prodotto da cambiare:</span><br/>
                <input type="text" name="id_vecchio"><br/>
                <span>Scegli il nuovo nome del prodotto:</span><br/>
                <input type="text" name="nome_nuovo"><br/>
                <input type="submit" value="Aggiorna">
            </form>
        </div>
    </body>
</html>